<%- include('../../shared/includes/head' , {title:"Login - Moneyy"}) %>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<meta name="google-signin-client_id" content="304379979277-qsbt6sf6s69oh7tnrhg2renc47vrb4b8.apps.googleusercontent.com">
<link rel="stylesheet" href="/styles/auth.css">
<style>
  .loading-spinner {
    display: none;
    width: 20px;
    height: 20px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid #3498db;
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin-right: 10px;
    vertical-align: middle;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .toast {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 16px 24px;
    border-radius: 4px;
    color: white;
    font-weight: 500;
    z-index: 10000;
    animation: slideIn 0.3s ease-out, slideOut 0.3s ease-out 3.7s forwards;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  }
  .toast-success {
    background-color: #4caf50;
  }
  .toast-error {
    background-color: #f44336;
  }
  .toast-info {
    background-color: #2196f3;
  }
  @keyframes slideIn {
    from {
      transform: translateX(400px);
      opacity: 0;
    }
    to {
      transform: translateX(0);
      opacity: 1;
    }
  }
  @keyframes slideOut {
    from {
      transform: translateX(0);
      opacity: 1;
    }
    to {
      transform: translateX(400px);
      opacity: 0;
    }
  }
</style>
</head>
<body>
<%- include("../../shared/includes/header") %>
<main>
    <h1>Login</h1>

    <form id="login-form" action="/login" method="POST">
        <input type="hidden" name="_csrf" value="<%= csrfToken %>">
        <% if(error){ %>
            <p class="error"><%= error %></p>
        <%}%>
        <%if(successMessage){%>
            <p class="success"><%=successMessage%></p>
        <%}%>
        <label for="email">Email: </label>
        <input type="email" name="email" value="<%=email%>" id="email" required>
        <label for="password">Password: </label>
        <input type="password" name="password" value="<%=password%>" id="password" minlength="8" required>
        <button type="submit">
          <span class="loading-spinner" id="spinner"></span>
          <span id="btn-text">Login</span>
        </button>
    </form>
    <p>Or <a href="/signup">Create new account</a> instead.</p>
</main>

document.getElementById('login-form').addEventListener('submit', async (e) => {
<script>
document.getElementById('login-form').addEventListener('submit', (e) => {
  const spinner = document.getElementById('spinner');
  const btnText = document.getElementById('btn-text');
  spinner.style.display = 'inline-block';
  btnText.textContent = 'Logging in...';
  // allow normal form submission to proceed (server will redirect)
});

function showToast(message, type = 'info') {
  const toast = document.createElement('div');
  toast.className = `toast toast-${type}`;
  toast.textContent = message;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 4000);
}

// Show success message if present
window.addEventListener('load', () => {
  const successMsg = document.querySelector('.success');
  if (successMsg) {
    showToast(successMsg.textContent, 'success');
  }
  const errorMsg = document.querySelector('.error');
  if (errorMsg) {
    showToast(errorMsg.textContent, 'error');
  }
});
</script>

<%- include("../../shared/includes/footer") %>
